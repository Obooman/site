<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/site/styles.e75654518b9928559a73.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2b2b2b}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#d4d0ab}.token.punctuation{color:#fefefe}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#ffa07a}.token.boolean,.token.number{color:#00e0e0}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#abe338}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#00e0e0}.token.atrule,.token.attr-value,.token.function{color:gold}.token.keyword{color:#00e0e0}.token.important,.token.regex{color:gold}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token.atrule,.token.attr-value,.token.function,.token.keyword,.token.operator,.token.selector{font-weight:700}.token.attr-value,.token.comment,.token.doctype,.token.function,.token.keyword,.token.operator,.token.property,.token.string{color:highlight}.token.attr-value,.token.url{font-weight:400}}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}.index-module--container--Eqp4Q{background-color:var(--theme-color);min-height:100%;padding:0 20px}.index-module--content--30-nr{width:var(--break-point);margin:0 auto;overflow:hidden}@media (max-width:700px){.index-module--content--30-nr{width:100%}}.index-module--header--2Vq0q{margin:30px 0;display:flex;justify-content:space-between}.main-module--logo--2GvGN{display:flex;flex-direction:column;align-items:flex-start;justify-content:center;background-color:var(--reverse-color);padding:8px;text-decoration:none}.main-module--logoRow--aaEQk{display:block;font-weight:700;font-size:18px;font-family:var(--title-font);color:var(--theme-color)}.index-module--switchButton--1LBCk{width:30px;height:30px;display:flex;align-items:center;justify-content:center}.index-module--link--3SX8Z{font-family:var(--title-font);font-weight:700;font-size:20px}.index-module--link--3SX8Z a{text-decoration:none}.index-module--subtitle--3POIg{font-size:14px;font-family:var(--title-font)}#___gatsby,#gatsby-focus-wrapper{height:100%}body{--primary-color:#13b3c5;--secondary-color:#222;--secondary-grey:#eaeaea;--title-font:Montserrat;--article-font:merriweather;--theme-color:#fbfbfb;--reverse-color:#0f0f0f;--break-point:700px}body.dark{--primary-color:#21c6d8;--secondary-color:#e6e6e6;--secondary-grey:#23232b;--article-font:Merriweather;--theme-color:#18181f;--reverse-color:#bfc7d8}body,html{margin:0;padding:0;height:100%}li,p{font-family:var(--article-font);font-size:16px;line-height:28px}h1,h2,h3,h4,h5,h6,li,p{color:var(--reverse-color)}h1,h2,h3,h4,h5,h6{font-family:var(--title-font)}article>h1{font-size:40px}li:before{content:"";width:10px;height:10px;background-color:#00f;position:absolute;left:-10px;top:0}li,ul{margin:0;padding:0}a{color:var(--primary-color)}blockquote{font-style:italic;border-left:4px solid var(--primary-color);margin-left:0;padding-left:10px}.gatsby-highlight-code-line{background-color:#feb;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #f99}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#23232b;font-family:Source Code Pro;font-size:14px}:not(pre)>code[class*=language-]{background-color:var(--secondary-grey);color:var(--secondary-color);padding:4px 10px;display:inline-block}img{max-width:100%;margin:0 auto}</style><meta name="generator" content="Gatsby 2.24.63"/><link href="https://fonts.googleapis.com/css?family=Montserrat|Merriweather&amp;display=swap" rel="stylesheet"/><link as="script" rel="preload" href="/site/webpack-runtime-bcf853e622a893142713.js"/><link as="script" rel="preload" href="/site/framework-eba153ab51c1c5913846.js"/><link as="script" rel="preload" href="/site/app-ec3330fb6a13301fb9a0.js"/><link as="script" rel="preload" href="/site/styles-c2fe8482057191dca484.js"/><link as="script" rel="preload" href="/site/commons-3b83b81c80e993ea5b7a.js"/><link as="script" rel="preload" href="/site/component---src-templates-blog-template-js-f9bc12d1c7191e34c8ab.js"/><link as="fetch" rel="preload" href="/site/page-data/slide/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/site/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="index-module--container--Eqp4Q"><div class="index-module--content--30-nr"><section><header class="index-module--header--2Vq0q"><a class="main-module--logo--2GvGN" href="/site/"><span class="main-module--logoRow--aaEQk">OBOO</span><span class="main-module--logoRow--aaEQk">CHENG</span></a><a href="" class="index-module--switchButton--1LBCk"></a></header><article><h1>Take snapshot of camera stream to mock local media</h1><div class="blog-post-content"><h2>Schema Definition</h2>
<p>Here is the schema and request URL definition.
the URL request will have JPEG file data as a response.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">schema <span class="token operator">=</span> <span class="token string">"some-schema"</span>
host <span class="token operator">=</span> “localframe”
<span class="token constant">URL</span> <span class="token operator">=</span> <span class="token string">"some-schema://localframe?n=0"</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h2>Tech explanation</h2>
<blockquote>
<p>Native( android, iOS ) keeps capturing video from device camera, every unit of thenative handling unit we call it the <em>frame.</em>
￼
/process In general/</p>
</blockquote>
<p>While web page want to get local video capturing frame slice as an image, an URL compose is needed. For example, in the EVC-kids project, a web page need to create an image which src attribute will be like this:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>“img”<span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">"some-schema://localframe"</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>By loading the image, the browser will send a network request to get the resource, the network request will be handled by native logic, waiting until next frame been got, the frame raw data will be converted to JPEG image buffer and be returned to webpage as the network response. while doing the frame to JPEG jobs, there are one rule we take, we won’t optimize the JPEG which cost CPU. If the frame is not ready or there’s something wrong with the image convert processing, the network request will be handled with a 404 response, under which condition frontend will try to have another request in 60ms.</p>
<p>Reason to return next frame instead of the current holding frame at the time web page the request arrives is that in this way native would not need to cache anything or store any data, all media info is in the memory.</p>
<p>While having two image switches to simulate the video, we have 2 image elements in the document, A and B.First, we set the src attribute of A to <em>some</em>schema://localframe?n=0_ , upon the onload event of A been fired we set it as visible, at the same time set the src attribute of B to <em>some</em>schema://localframe?n=1<em>, upon the onload event of B been fired we replace A with B and at the same time set src attribute of A to _some-schema://localframe?n=2</em>, so and so and the video animate.</p></div></article></section><div style="height:100px"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/slide";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4d72d05cbd873a603f55.js"],"app":["/app-ec3330fb6a13301fb9a0.js"],"component---src-pages-index-js":["/component---src-pages-index-js-479bfd417fd83f362852.js"],"component---src-templates-blog-template-js":["/component---src-templates-blog-template-js-f9bc12d1c7191e34c8ab.js"]};/*]]>*/</script><script src="/site/polyfill-4d72d05cbd873a603f55.js" nomodule=""></script><script src="/site/component---src-templates-blog-template-js-f9bc12d1c7191e34c8ab.js" async=""></script><script src="/site/commons-3b83b81c80e993ea5b7a.js" async=""></script><script src="/site/styles-c2fe8482057191dca484.js" async=""></script><script src="/site/app-ec3330fb6a13301fb9a0.js" async=""></script><script src="/site/framework-eba153ab51c1c5913846.js" async=""></script><script src="/site/webpack-runtime-bcf853e622a893142713.js" async=""></script></body></html>